<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Prices of german houses | Teraku's blog</title><meta name=keywords content="blog,data"><meta name=description content="I scraped the house market prices for six months."><meta name=author content="Teraku"><link rel=canonical href=https://teraku.de/posts/house-prices-2020/><link href=/assets/css/stylesheet.min.16158c8087e20777fae960c355760affd58290b604a39d72053581389a2a6bdb.css integrity="sha256-FhWMgIfiB3f66WDDVXYK/9WCkLYEo51yBTWBOJoqa9s=" rel="preload stylesheet" as=style><link rel=icon href=https://teraku.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://teraku.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://teraku.de/favicon-32x32.png><link rel=apple-touch-icon href=https://teraku.de/apple-touch-icon.png><link rel=mask-icon href=https://teraku.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><meta property="og:title" content="Prices of german houses"><meta property="og:description" content="I scraped the house market prices for six months."><meta property="og:type" content="article"><meta property="og:url" content="https://teraku.de/posts/house-prices-2020/"><meta property="article:published_time" content="2020-09-02T17:46:21+02:00"><meta property="article:modified_time" content="2020-09-02T17:46:21+02:00"><meta property="og:site_name" content="Teraku's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Prices of german houses"><meta name=twitter:description content="I scraped the house market prices for six months."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Prices of german houses","name":"Prices of german houses","description":"Prices of german houses So for a while I had a scraper running, which, once a day, scraped housing prices from chosen regions in Germany. I accumulated about 6 month of data until ‚Ä¶","keywords":["blog","data"],"articleBody":"Prices of german houses So for a while I had a scraper running, which, once a day, scraped housing prices from chosen regions in Germany. I accumulated about 6 month of data until I stopped it, mainly because I didn‚Äôt feel like I‚Äôd ever properly utilise it.\nI decided to at least show some of it. This post is basically excerpts from a Jupyter notebook. A link to the data can be found at the end.\n Small side-note: The diagrams in this post are best viewed in day mode. Sorry, fellow night-modersüåë\n Reading raw data The data was split into one newline delimited JSON per day. So first, read it into a DataFrame.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  import os import json from typing import List, Dict def read_data(path: str) - List[Dict]: \"\"\" Reads all JSONs from the data folder. \"\"\" data = [] for filename in os.listdir(path): if filename.endswith(\".json\") or filename.endswith(\".jl\"): with open(os.path.join(path, filename)) as f: for jl in f: data.append(json.loads(jl)) return data import pandas as pd raw_data = pd.DataFrame(read_data(\".\"))   Cleansing data The next step was to clean the data a bit, since it was quite messy (scraped directly out of HTML). Let‚Äôs focus on the important bits:\n One of the dimensions to group by will be time. So we format the crawl_time into datetime. area_total somtimes contains prices. Talk about messy, so we filter that price_num contains decimal signs, ‚Ç¨ signs and also ranges. We replace as much as we can, but ranges will be dropped altogether. room_number usually contains the rooms twice, so we regexp the first number.  1 2 3 4 5 6  raw_data[\"date\"] = pd.to_datetime(raw_data[\"crawl_time\"], format=\"%Y-%m-%dT%H:%M:%SZ\") raw_dataraw_ = raw_data[~raw_data[\"area_total\"].str.contains(\"‚Ç¨\")] raw_data[\"price_num\"] = pd.to_numeric(raw_data[\"price\"].str.replace(\"‚Ç¨\", \"\").str.replace(\".\", \"\").str.replace(\",\", \"\"), errors=\"coerce\") raw_data[\"total_area\"] = pd.to_numeric(raw_data[\"area_total\"].str.replace(\"m2\", \"\").str.replace(\"¬≤\", \"\").str.replace(\"m\", \"\").str.replace(\",\", \"\"), errors=\"coerce\") raw_data[\"area\"] = pd.to_numeric(raw_data[\"area_living\"].str.replace(\"m2\", \"\").str.replace(\"¬≤\", \"\").str.replace(\"m\", \"\").str.replace(\",\", \"\"), errors=\"coerce\") raw_data[\"rooms\"] = pd.to_numeric(raw_data[\"room_number\"].str.extract(r\"(^\\d+[\\s])\", expand=True)[0])   Then I moved everything I needed into a clean dataframe. From there, I also removed one weird outlier (some castle costing 1.5B‚Ç¨üè∞).\n1 2 3 4 5  d = raw_data[[\"date\", \"search_region\", \"expose_id\", \"price_num\", \"area\", \"total_area\", \"rooms\"]] # Remove weird outlier outlier = raw_data[\"price_num\"].idxmax(axis=\"columns\") d.iloc[[outlier]] d = d[d[\"price_num\"]  1000000000]   Now let‚Äôs get an overview of the general shape of the data.\n1 2  print(raw_data.search_region.unique()) print(len(raw_data))   results in\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  ['baden-wuerttemberg/stuttgart' 'baden-wuerttemberg/mannheim' 'baden-wuerttemberg/freiburg-im-breisgau' 'baden-wuerttemberg/karlsruhe' 'baden-wuerttemberg/ortenaukreis' 'baden-wuerttemberg/heidelberg' 'bayern/muenchen-kreis' 'bayern/wuerzburg-kreis' 'bayern/nuernberg' 'bayern/nuernberger-land-kreis' 'hessen/frankfurt-am-main' 'hessen/offenbach-am-main' 'hessen/wiesbaden' 'rheinland-pfalz/mainz' 'nordrhein-westfalen/aachen-kreis' 'nordrhein-westfalen/bonn' 'nordrhein-westfalen/koeln' 'nordrhein-westfalen/duesseldorf' 'nordrhein-westfalen/essen' 'nordrhein-westfalen/dortmund' 'nordrhein-westfalen/muenster' 'nordrhein-westfalen/bielefeld' 'bremen/haus-kaufen?pagenumber=1' 'hamburg/hamburg' 'niedersachsen/hannover-kreis' 'berlin/berlin' 'sachsen/leipzig-kreis' 'sachsen/dresden' 'bremen/haus-kaufen?pagenumber=19' 'bremen/haus-kaufen?pagenumber=18' 'bremen/haus-kaufen?pagenumber=17' 'bremen/haus-kaufen?pagenumber=16' 'bremen/haus-kaufen?pagenumber=15' 'bremen/haus-kaufen?pagenumber=14' 'bremen/haus-kaufen?pagenumber=13' 'bremen/haus-kaufen?pagenumber=12' 'bremen/haus-kaufen?pagenumber=11' 'bremen/haus-kaufen?pagenumber=10' 'bremen/haus-kaufen?pagenumber=9' 'bremen/haus-kaufen?pagenumber=8' 'bremen/haus-kaufen?pagenumber=7' 'bremen/haus-kaufen?pagenumber=6' 'bremen/haus-kaufen?pagenumber=5' 'bremen/haus-kaufen?pagenumber=4' 'bremen/haus-kaufen?pagenumber=3' 'bremen/haus-kaufen?pagenumber=2' 'bremen/wohnung-kaufen?pagenumber=1'] 298098   Let‚Äôs get an overview of the totals. Let‚Äôs plot the overall average and median.\n1 2 3 4 5 6 7  agg_per_month = d[[\"date\", \"search_region\", \"price_num\"]].copy() agg_per_month = agg_per_month[[\"date\", \"price_num\"]][agg_per_month[\"price_num\"].notna()] avg_per_month = agg_per_month.rename(columns={\"price_num\": \"average\"}).resample('M', on=\"date\", kind=\"timestamp\").mean() med_per_month = agg_per_month.rename(columns={\"price_num\": \"median\"}).resample('M', on=\"date\", kind=\"timestamp\").median() ax = med_per_month.plot() avg_per_month.plot(ax=ax, secondary_y=True, title=\"house prices in german cities in ‚Ç¨\")     Average and median overall   One can definitly see the dent that the corona crisis created. Let‚Äôs dive a bit into the various cities and regions.\n1 2 3 4 5 6 7 8 9  bundeslaender = [\"baden-wuerttemberg\", \"bayern\", \"hessen\", \"nordrhein-westfalen\", \"hamburg\", \"niedersachsen\", \"berlin\", \"sachsen\"] df = d[[\"date\", \"search_region\", \"price_num\"]].copy()[agg_per_month[\"price_num\"].notna()] for b in bundeslaender: med = df[df[\"search_region\"].str.startswith(b)][[\"date\", \"price_num\"]].rename(columns={\"price_num\": \"median\"}).resample('M', on=\"date\", kind=\"timestamp\").median() avg = df[df[\"search_region\"].str.startswith(b)][[\"date\", \"price_num\"]].rename(columns={\"price_num\": \"average\"}).resample('M', on=\"date\", kind=\"timestamp\").mean() ax = med.plot() avg.plot(ax=ax, secondary_y=True, title=b)   This produces various graphs for the Bundesl√§nder.\nAverage and median Baden-W√ºrttemberg   Average and median Bayern   Average and median Hessen   Average and median NRW   Average and median Hamburg   Average and median Niedersachsen   Average and median Berlin   Average and median Sachsen   Data Since I‚Äôm a data engineer, and much more about collection and providing data, than about analysing, I will do exactly what I do best and provide the data. I packed it all into one JSON, instead of many, and compressed it with 7z.\nDE_house_prices_201912-202006.7z\nIf you do anything nice with it, feel free to contact me via twitterüßë‚Äçüíª.\nLessons learned What did I learn? First of all, I‚Äôm not much of a data scientist. While I do have ideas of what else I could with the data, it does not really motivate me to keep on going.\n For example, one could split out prices by area, rooms, city center or suburbs, ‚Ä¶\n Working with pandas also does not feel entirely intuiative to me, mostly because most of data wrangling I usually do between low-level languages and python. And whenever I really do want to display some results, I fall back to tables and excel. Which admittedly works fine for pretty much all my use-cases. And although it‚Äôs nice to try out new things, sticking to what you love to do usually yields in more fun. Especially for side projects!üòÉ\nSo, look forward to that. Still, this might not be my last dip into dataframes, notebooks and plotting.\n","wordCount":"827","inLanguage":"en","datePublished":"2020-09-02T17:46:21+02:00","dateModified":"2020-09-02T17:46:21+02:00","author":{"@type":"Person","name":"Teraku"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://teraku.de/posts/house-prices-2020/"},"publisher":{"@type":"Organization","name":"Teraku's blog","logo":{"@type":"ImageObject","url":"https://teraku.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://teraku.de accesskey=h title="Home (Alt + H)"><img src=/apple-touch-icon.png alt=logo aria-label=logo height=35>Home</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://teraku.de/categories/ title=categories><span>categories</span></a></li><li><a href=https://teraku.de/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Prices of german houses</h1><div class=post-description>I scraped the house market prices for six months.</div><div class=post-meta>September 2, 2020&nbsp;¬∑&nbsp;Teraku</div></header><div class=post-content><h1 id=prices-of-german-houses>Prices of german houses<a hidden class=anchor aria-hidden=true href=#prices-of-german-houses>#</a></h1><p>So for a while I had a scraper running, which, once a day, scraped housing prices from chosen regions in Germany.
I accumulated about 6 month of data until I stopped it, mainly because I didn&rsquo;t feel like I&rsquo;d ever properly utilise it.</p><p>I decided to at least show some of it.
This post is basically excerpts from a Jupyter notebook.
A link to the data can be found at the end.</p><blockquote><p>Small side-note: The diagrams in this post are best viewed in day mode. Sorry, fellow night-modersüåë</p></blockquote><h1 id=reading-raw-data>Reading raw data<a hidden class=anchor aria-hidden=true href=#reading-raw-data>#</a></h1><p>The data was split into one newline delimited JSON per day.
So first, read it into a <code>DataFrame</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>json</span>
<span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Dict</span>

<span class=k>def</span> <span class=nf>read_data</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
    <span class=s2>&#34;&#34;&#34; Reads all JSONs from the data folder. &#34;&#34;&#34;</span>
    <span class=n>data</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>filename</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>filename</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;.json&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>filename</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&#34;.jl&#34;</span><span class=p>):</span>
            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>filename</span><span class=p>))</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
                <span class=k>for</span> <span class=n>jl</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
                    <span class=n>data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>jl</span><span class=p>))</span>

    <span class=k>return</span> <span class=n>data</span>


<span class=kn>import</span> <span class=nn>pandas</span> <span class=kn>as</span> <span class=nn>pd</span>

<span class=n>raw_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>read_data</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>))</span>
</code></pre></td></tr></table></div></div><h1 id=cleansing-data>Cleansing data<a hidden class=anchor aria-hidden=true href=#cleansing-data>#</a></h1><p>The next step was to clean the data a bit, since it was quite messy (scraped directly out of HTML).
Let&rsquo;s focus on the important bits:</p><ul><li>One of the dimensions to group by will be time. So we format the <code>crawl_time</code> into <code>datetime</code>.</li><li><code>area_total</code> somtimes contains prices. Talk about messy, so we filter that</li><li><code>price_num</code> contains decimal signs, ‚Ç¨ signs and also ranges. We replace as much as we can, but ranges will be dropped altogether.</li><li><code>room_number</code> usually contains the rooms twice, so we regexp the first number.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;date&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_datetime</span><span class=p>(</span><span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;crawl_time&#34;</span><span class=p>],</span> <span class=n>format</span><span class=o>=</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2>T%H:%M:%SZ&#34;</span><span class=p>)</span>
<span class=n>raw_dataraw_</span> <span class=o>=</span> <span class=n>raw_data</span><span class=p>[</span><span class=o>~</span><span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;area_total&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>contains</span><span class=p>(</span><span class=s2>&#34;‚Ç¨&#34;</span><span class=p>)]</span>
<span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;price_num&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;price&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;‚Ç¨&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>),</span> <span class=n>errors</span><span class=o>=</span><span class=s2>&#34;coerce&#34;</span><span class=p>)</span>
<span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;total_area&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;area_total&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;m2&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;¬≤&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;m&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>),</span> <span class=n>errors</span><span class=o>=</span><span class=s2>&#34;coerce&#34;</span><span class=p>)</span>
<span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;area&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;area_living&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;m2&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;¬≤&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;m&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>),</span> <span class=n>errors</span><span class=o>=</span><span class=s2>&#34;coerce&#34;</span><span class=p>)</span>
<span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;rooms&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;room_number&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>extract</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;(^\d+[\s])&#34;</span><span class=p>,</span> <span class=n>expand</span><span class=o>=</span><span class=bp>True</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>
</code></pre></td></tr></table></div></div><p>Then I moved everything I needed into a clean dataframe.
From there, I also removed one weird outlier (some castle costing 1.5B‚Ç¨üè∞).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=n>d</span> <span class=o>=</span> <span class=n>raw_data</span><span class=p>[[</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=s2>&#34;search_region&#34;</span><span class=p>,</span> <span class=s2>&#34;expose_id&#34;</span><span class=p>,</span> <span class=s2>&#34;price_num&#34;</span><span class=p>,</span> <span class=s2>&#34;area&#34;</span><span class=p>,</span> <span class=s2>&#34;total_area&#34;</span><span class=p>,</span> <span class=s2>&#34;rooms&#34;</span><span class=p>]]</span>
<span class=c1># Remove weird outlier</span>
<span class=n>outlier</span> <span class=o>=</span> <span class=n>raw_data</span><span class=p>[</span><span class=s2>&#34;price_num&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>idxmax</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=s2>&#34;columns&#34;</span><span class=p>)</span>
<span class=n>d</span><span class=o>.</span><span class=n>iloc</span><span class=p>[[</span><span class=n>outlier</span><span class=p>]]</span>
<span class=n>d</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=n>d</span><span class=p>[</span><span class=s2>&#34;price_num&#34;</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>1000000000</span><span class=p>]</span>
</code></pre></td></tr></table></div></div><p>Now let&rsquo;s get an overview of the general shape of the data.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=k>print</span><span class=p>(</span><span class=n>raw_data</span><span class=o>.</span><span class=n>search_region</span><span class=o>.</span><span class=n>unique</span><span class=p>())</span>
<span class=k>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>raw_data</span><span class=p>))</span>
</code></pre></td></tr></table></div></div><p>results in</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=p>[</span><span class=s1>&#39;baden-wuerttemberg/stuttgart&#39;</span> <span class=s1>&#39;baden-wuerttemberg/mannheim&#39;</span>
 <span class=s1>&#39;baden-wuerttemberg/freiburg-im-breisgau&#39;</span> <span class=s1>&#39;baden-wuerttemberg/karlsruhe&#39;</span>
 <span class=s1>&#39;baden-wuerttemberg/ortenaukreis&#39;</span> <span class=s1>&#39;baden-wuerttemberg/heidelberg&#39;</span>
 <span class=s1>&#39;bayern/muenchen-kreis&#39;</span> <span class=s1>&#39;bayern/wuerzburg-kreis&#39;</span> <span class=s1>&#39;bayern/nuernberg&#39;</span>
 <span class=s1>&#39;bayern/nuernberger-land-kreis&#39;</span> <span class=s1>&#39;hessen/frankfurt-am-main&#39;</span>
 <span class=s1>&#39;hessen/offenbach-am-main&#39;</span> <span class=s1>&#39;hessen/wiesbaden&#39;</span> <span class=s1>&#39;rheinland-pfalz/mainz&#39;</span>
 <span class=s1>&#39;nordrhein-westfalen/aachen-kreis&#39;</span> <span class=s1>&#39;nordrhein-westfalen/bonn&#39;</span>
 <span class=s1>&#39;nordrhein-westfalen/koeln&#39;</span> <span class=s1>&#39;nordrhein-westfalen/duesseldorf&#39;</span>
 <span class=s1>&#39;nordrhein-westfalen/essen&#39;</span> <span class=s1>&#39;nordrhein-westfalen/dortmund&#39;</span>
 <span class=s1>&#39;nordrhein-westfalen/muenster&#39;</span> <span class=s1>&#39;nordrhein-westfalen/bielefeld&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=1&#39;</span> <span class=s1>&#39;hamburg/hamburg&#39;</span>
 <span class=s1>&#39;niedersachsen/hannover-kreis&#39;</span> <span class=s1>&#39;berlin/berlin&#39;</span> <span class=s1>&#39;sachsen/leipzig-kreis&#39;</span>
 <span class=s1>&#39;sachsen/dresden&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=19&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=18&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=17&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=16&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=15&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=14&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=13&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=12&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=11&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=10&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=9&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=8&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=7&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=6&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=5&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=4&#39;</span> <span class=s1>&#39;bremen/haus-kaufen?pagenumber=3&#39;</span>
 <span class=s1>&#39;bremen/haus-kaufen?pagenumber=2&#39;</span> <span class=s1>&#39;bremen/wohnung-kaufen?pagenumber=1&#39;</span><span class=p>]</span>
<span class=mi>298098</span>
</code></pre></td></tr></table></div></div><p>Let&rsquo;s get an overview of the totals. Let&rsquo;s plot the overall average and median.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=n>agg_per_month</span> <span class=o>=</span> <span class=n>d</span><span class=p>[[</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=s2>&#34;search_region&#34;</span><span class=p>,</span> <span class=s2>&#34;price_num&#34;</span><span class=p>]]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
<span class=n>agg_per_month</span> <span class=o>=</span> <span class=n>agg_per_month</span><span class=p>[[</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=s2>&#34;price_num&#34;</span><span class=p>]][</span><span class=n>agg_per_month</span><span class=p>[</span><span class=s2>&#34;price_num&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>notna</span><span class=p>()]</span>
<span class=n>avg_per_month</span> <span class=o>=</span> <span class=n>agg_per_month</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;price_num&#34;</span><span class=p>:</span> <span class=s2>&#34;average&#34;</span><span class=p>})</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
<span class=n>med_per_month</span> <span class=o>=</span> <span class=n>agg_per_month</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;price_num&#34;</span><span class=p>:</span> <span class=s2>&#34;median&#34;</span><span class=p>})</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>median</span><span class=p>()</span>

<span class=n>ax</span> <span class=o>=</span> <span class=n>med_per_month</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
<span class=n>avg_per_month</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>,</span> <span class=n>secondary_y</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&#34;house prices in german cities in ‚Ç¨&#34;</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><figure><img src=/media/house_prices/output_7_1.png><figcaption>Average and median overall</figcaption></figure><p>One can definitly see the dent that the corona crisis created.
Let&rsquo;s dive a bit into the various cities and regions.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=n>bundeslaender</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;baden-wuerttemberg&#34;</span><span class=p>,</span> <span class=s2>&#34;bayern&#34;</span><span class=p>,</span> <span class=s2>&#34;hessen&#34;</span><span class=p>,</span> <span class=s2>&#34;nordrhein-westfalen&#34;</span><span class=p>,</span> <span class=s2>&#34;hamburg&#34;</span><span class=p>,</span> <span class=s2>&#34;niedersachsen&#34;</span><span class=p>,</span> <span class=s2>&#34;berlin&#34;</span><span class=p>,</span> <span class=s2>&#34;sachsen&#34;</span><span class=p>]</span>
<span class=n>df</span> <span class=o>=</span> <span class=n>d</span><span class=p>[[</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=s2>&#34;search_region&#34;</span><span class=p>,</span> <span class=s2>&#34;price_num&#34;</span><span class=p>]]</span><span class=o>.</span><span class=n>copy</span><span class=p>()[</span><span class=n>agg_per_month</span><span class=p>[</span><span class=s2>&#34;price_num&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>notna</span><span class=p>()]</span>

<span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>bundeslaender</span><span class=p>:</span>
    <span class=n>med</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s2>&#34;search_region&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>b</span><span class=p>)][[</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=s2>&#34;price_num&#34;</span><span class=p>]]</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;price_num&#34;</span><span class=p>:</span> <span class=s2>&#34;median&#34;</span><span class=p>})</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>median</span><span class=p>()</span>
    <span class=n>avg</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s2>&#34;search_region&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>b</span><span class=p>)][[</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=s2>&#34;price_num&#34;</span><span class=p>]]</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;price_num&#34;</span><span class=p>:</span> <span class=s2>&#34;average&#34;</span><span class=p>})</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=s1>&#39;M&#39;</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=n>kind</span><span class=o>=</span><span class=s2>&#34;timestamp&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
    
    <span class=n>ax</span> <span class=o>=</span> <span class=n>med</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
    <span class=n>avg</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>ax</span><span class=o>=</span><span class=n>ax</span><span class=p>,</span> <span class=n>secondary_y</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=n>b</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>This produces various graphs for the Bundesl√§nder.</p><h2 id=average-and-median-baden-w√ºrttemberg>Average and median Baden-W√ºrttemberg<a hidden class=anchor aria-hidden=true href=#average-and-median-baden-w√ºrttemberg>#</a></h2><figure><img src=/media/house_prices/output_9_0.png></figure><h2 id=average-and-median-bayern>Average and median Bayern<a hidden class=anchor aria-hidden=true href=#average-and-median-bayern>#</a></h2><figure><img src=/media/house_prices/output_9_1.png></figure><h2 id=average-and-median-hessen>Average and median Hessen<a hidden class=anchor aria-hidden=true href=#average-and-median-hessen>#</a></h2><figure><img src=/media/house_prices/output_9_2.png></figure><h2 id=average-and-median-nrw>Average and median NRW<a hidden class=anchor aria-hidden=true href=#average-and-median-nrw>#</a></h2><figure><img src=/media/house_prices/output_9_3.png></figure><h2 id=average-and-median-hamburg>Average and median Hamburg<a hidden class=anchor aria-hidden=true href=#average-and-median-hamburg>#</a></h2><figure><img src=/media/house_prices/output_9_4.png></figure><h2 id=average-and-median-niedersachsen>Average and median Niedersachsen<a hidden class=anchor aria-hidden=true href=#average-and-median-niedersachsen>#</a></h2><figure><img src=/media/house_prices/output_9_5.png></figure><h2 id=average-and-median-berlin>Average and median Berlin<a hidden class=anchor aria-hidden=true href=#average-and-median-berlin>#</a></h2><figure><img src=/media/house_prices/output_9_6.png></figure><h2 id=average-and-median-sachsen>Average and median Sachsen<a hidden class=anchor aria-hidden=true href=#average-and-median-sachsen>#</a></h2><figure><img src=/media/house_prices/output_9_7.png></figure><h1 id=data>Data<a hidden class=anchor aria-hidden=true href=#data>#</a></h1><p>Since I&rsquo;m a data engineer, and much more about collection and providing data, than about analysing, I will do exactly what I do best and provide the data.
I packed it all into one JSON, instead of many, and compressed it with 7z.</p><p><a href=https://teraku.me/media/house_prices/house_prices_201912-202006.7z>DE_house_prices_201912-202006.7z</a></p><p>If you do anything nice with it, feel free to contact me via <a href=https://twitter.com/Milchdealer>twitterüßë‚Äçüíª</a>.</p><h1 id=lessons-learned>Lessons learned<a hidden class=anchor aria-hidden=true href=#lessons-learned>#</a></h1><p>What did I learn?
First of all, I&rsquo;m not much of a data scientist.
While I do have ideas of what else I could with the data, it does not really motivate me to keep on going.</p><blockquote><p>For example, one could split out prices by area, rooms, city center or suburbs, &mldr;</p></blockquote><p>Working with pandas also does not feel entirely intuiative to me, mostly because most of data wrangling I usually do between low-level languages and python.
And whenever I really do want to display some results, I fall back to tables and excel.
Which admittedly works fine for pretty much all my use-cases.
And although it&rsquo;s nice to try out new things, sticking to what you love to do usually yields in more fun.
Especially for side projects!üòÉ</p><p>So, look forward to that. Still, this might not be my last dip into dataframes, notebooks and plotting.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://teraku.de/tags/blog/>blog</a></li><li><a href=https://teraku.de/tags/data/>data</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://teraku.de>Teraku's blog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.replaceState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>